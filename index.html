<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Web Map – Two Datasets + Sortable Table</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #app { height: 100%; position: relative; }
    #map { position: fixed; inset: 0; }
    #panel{
      position: fixed; top:0; right:0; bottom:0;
      width: 380px; background: rgba(255,255,255,0.92);
      backdrop-filter: blur(3px);
      border-left: 1px solid #e7e7e7; overflow:auto; padding:14px 16px;
      box-shadow: -6px 0 18px rgba(0,0,0,.06);
    }
    #panel h1{ margin: 6px 0 8px; font-size: 20px; }
    .table-wrap{ overflow-x:auto; }
    table{ width:100%; border-collapse:collapse; font-size:14px; }
    th,td{ padding:8px 10px; border-bottom:1px solid #eee; text-align:left; }
    th{ cursor:pointer; user-select:none; background:#fafafa; position:sticky; top:0; }
    tr:hover td{ background:#f7faff; }
    @media (max-width:1024px){ #panel{ display:none; } }
  </style>
</head>
<body>
  <div id="app">
    <div id="map"></div>
    <aside id="panel">
      <h1>My Custom Web Map</h1>
      <p>Two datasets visualized. Click a column to sort.</p>
      <div class="table-wrap">
        <table id="featTable">
          <thead>
            <tr>
              <th data-key="id">ID ▲▼</th>
              <th data-key="mag">Magnitude ▲▼</th>
              <th data-key="date">Date ▲▼</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </aside>
  </div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2lydW13IiwiYSI6ImNtaGNsMnczejI4a2cybXB1b3h6dHBuaHkifQ.fO5Cyk2RL57zq0RKG8BDkg';
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v11',  // different from earthquake.html
      center: [138, 38],
      zoom: 5.5
    });
    map.addControl(new mapboxgl.NavigationControl(), 'top-left');

    const tbody = document.querySelector('#featTable tbody');
    let rowsCache = [];
    let sortState = { key: null, dir: 1 };

    function renderTable(rows){
      tbody.innerHTML = rows.map(r =>
        `<tr><td>${r.id}</td><td>${r.mag}</td><td>${r.date}</td></tr>`
      ).join('');
    }

    function sortBy(key){
      if (sortState.key === key) sortState.dir *= -1; else { sortState.key = key; sortState.dir = 1; }
      rowsCache.sort((a,b)=>{
        const aRaw = a[key]; const bRaw = b[key];
        const aNum = parseFloat(aRaw); const bNum = parseFloat(bRaw);
        const bothNumeric = !isNaN(aNum) && !isNaN(bNum);
        if (bothNumeric){
          return (aNum - bNum) * sortState.dir;
        } else {

