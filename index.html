<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <title>My GeoJSON Map Deliverable</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    #container {
      display: flex;
      flex-direction: row-reverse;
      align-items: stretch;
      height: 100vh;
    }
    #side-panel {
      flex-basis: 450px;
      overflow-y: auto;
      padding: 16px;
      box-sizing: border-box;
      background: #fff;
      border-left: 1px solid #ddd;
    }
    #map { flex-grow: 1; }
    h2 { margin-top: 0; }
    button { margin-bottom: 10px; padding: 6px 10px; cursor: pointer; }
    table {
      border-collapse: collapse;
      width: 100%;
      border: 1px solid #ddd;
    }
    th, td { text-align: left; padding: 8px; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    @media (max-width: 1024px) {
      #side-panel { display: none; }
    }
  </style>
</head>

<body>
  <main id="container">
    <div id="side-panel">
      <h2>My GeoJSON Table</h2>
      <button id="sortBtn">Sort by Value</button>
      <table id="data-table">
        <tr>
          <th>ID</th>
          <th>Value</th>
          <th>Info</th>
        </tr>
      </table>
    </div>
    <div id="map"></div>
  </main>

  <script>
    mapboxgl.accessToken = "pk.eyJ1IjoiZ2lydW13IiwiYSI6ImNtaGNsMnczejI4a2cybXB1b3h6dHBuaHkifQ.fO5Cyk2RL57zq0RKG8BDkg";

    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/outdoors-v12",
      center: [-122.3, 47.6],
      zoom: 8
    });

    async function geojsonFetch() {
      let response, points, polygons;
      response = await fetch("assets/my_points.geojson");
      points = await response.json();
      response = await fetch("assets/my_polygons.geojson");
      polygons = await response.json();

      map.on("load", function() {
        map.addSource("polygons", { type: "geojson", data: polygons });
        map.addLayer({
          id: "polygons-layer",
          type: "fill",
          source: "polygons",
          paint: {
            "fill-color": "#00aaff",
            "fill-opacity": 0.4,
            "fill-outline-color": "#0077aa"
          }
        });

        map.addSource("points", { type: "geojson", data: points });
        map.addLayer({
          id: "points-layer",
          type: "circle",
          source: "points",
          paint: {
            "circle-radius": 7,
            "circle-color": "#ff4d4d",
            "circle-stroke-width": 2,
            "circle-stroke-color": "#fff"
          }
        });

        map.on("click", "points-layer", (e) => {
          const props = e.features[0].properties;
          new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`<strong>${props.name || "Unnamed"}</strong><br>${props.info || ""}`)
            .addTo(map);
        });

        map.on("mouseenter", "points-layer", () => map.getCanvas().style.cursor = "pointer");
        map.on("mouseleave", "points-layer", () => map.getCanvas().style.cursor = "");

        const table = document.getElementById("data-table");
        for (let i = 0; i < points.features.length; i++) {
          const row = table.insertRow(-1);
          row.insertCell(0).innerHTML = points.features[i].properties.id || i;
          row.insertCell(1).innerHTML = points.features[i].properties.value || "";
          row.insertCell(2).innerHTML = points.features[i].properties.info || "";
        }

        document.getElementById("sortBtn").addEventListener("click", function() {
          let table = document.getElementById("data-table"), switching = true;
          while (switching) {
            switching = false;
            let rows = table.rows;
            for (let i = 1; i < (rows.length - 1); i++) {
              let x = parseFloat(rows[i].getElementsByTagName("td")[1].innerHTML);
              let y = parseFloat(rows[i + 1].getElementsByTagName("td")[1].innerHTML);
              if (x < y) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                break;
              }
            }
          }
        });
      });
    }

    geojsonFetch();
  </script>
</body>
</html>
